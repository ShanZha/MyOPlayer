Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/misc.xml	(date 1453798017000)
+++ .idea/misc.xml	(date 1453882873000)
@@ -3,34 +3,6 @@
   <component name="EntryPointsManager">
     <entry_points version="2.0" />
   </component>
-  <component name="ProjectInspectionProfilesVisibleTreeState">
-    <entry key="Project Default">
-      <profile-state>
-        <expanded-state>
-          <State>
-            <id />
-          </State>
-          <State>
-            <id>Android</id>
-          </State>
-          <State>
-            <id>Android Lint</id>
-          </State>
-          <State>
-            <id>Java</id>
-          </State>
-          <State>
-            <id>Java language level migration aidsJava</id>
-          </State>
-        </expanded-state>
-        <selected-state>
-          <State>
-            <id>AndroidNonConstantResIdsInSwitch</id>
-          </State>
-        </selected-state>
-      </profile-state>
-    </entry>
-  </component>
   <component name="ProjectLevelVcsManager" settingsEditedManually="false">
     <OptionsSetting value="true" id="Add" />
     <OptionsSetting value="true" id="Remove" />
@@ -41,7 +13,7 @@
     <ConfirmationsSetting value="0" id="Add" />
     <ConfirmationsSetting value="0" id="Remove" />
   </component>
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_6" default="true" assert-keyword="true" jdk-15="true" project-jdk-name="1.7" project-jdk-type="JavaSDK">
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_7" default="true" assert-keyword="true" jdk-15="true" project-jdk-name="1.7" project-jdk-type="JavaSDK">
     <output url="file://$PROJECT_DIR$/build/classes" />
   </component>
   <component name="ProjectType">
\ No newline at end of file
Index: app/src/main/java/com/nmbb/oplayer/po/POMedia.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>GBK
===================================================================
--- app/src/main/java/com/nmbb/oplayer/po/POMedia.java	(date 1453798017000)
+++ app/src/main/java/com/nmbb/oplayer/po/POMedia.java	(date 1453882873000)
@@ -18,7 +18,7 @@
     public String title;
     /** 视频标题拼音 */
     @DatabaseField
-    public String title_pinyin;
+    public String title_key;
     /** 视频路径 */
     @DatabaseField
     public String path;
Index: app/src/main/java/com/nmbb/oplayer/receiver/MediaScannerReceiver.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/nmbb/oplayer/receiver/MediaScannerReceiver.java	(date 1453798017000)
+++ app/src/main/java/com/nmbb/oplayer/receiver/MediaScannerReceiver.java	(date 1453882873000)
@@ -1,15 +1,53 @@
 package com.nmbb.oplayer.receiver;
 
-import io.vov.vitamio.VIntent;
-import android.app.ActivityManager;
-import android.app.ActivityManager.RunningServiceInfo;
 import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
-import android.util.Log;
+import android.net.Uri;
+import android.os.Bundle;
+import android.os.Environment;
 
+import com.nmbb.oplayer.service.MediaScannerService;
+
 public class MediaScannerReceiver extends BroadcastReceiver {
-	private static boolean isScanning = false;
+
+	public static final String ACTION_MEDIA_SCANNER_SCAN_FILE = "";
+	public static final String ACTION_MEDIA_SCANNER_SCAN_DIRECTORY = "";
+
+	@Override
+	public void onReceive(Context context, Intent intent) {
+		String action=intent.getAction();
+		Uri uri=intent.getData();
+		if(action.equals(Intent.ACTION_BOOT_COMPLETED)){
+			//扫描整个SD卡目录
+			//FIXME 处理多个SD卡的问题
+			//			Environment.getExternalStorageDirectory().getParentFile();
+			scanDirectory(context, Environment.getExternalStorageDirectory().getAbsolutePath());
+		}else if (uri.getScheme().equals("file")){
+			String path=uri.getPath();
+			if (action.equals(Intent.ACTION_MEDIA_MOUNTED)){
+				scanDirectory(context,path);
+			}else if (action.equals(ACTION_MEDIA_SCANNER_SCAN_FILE)&& path != null){
+				scanFile(context,path);
+			}else  if (action.equals(ACTION_MEDIA_SCANNER_SCAN_DIRECTORY)&& path != null){
+				scanDirectory(context,path);
+			}
+		}
+	}
+
+	/*扫描文件夹*/
+	private void scanDirectory(Context context,String volume){
+		Bundle args=new Bundle();
+		args.putString(MediaScannerService.EXTRA_DIRECTORY,volume);
+		context.startService(new Intent(context, MediaScannerService.class).putExtras(args));
+	}
+
+	private void scanFile(Context context,String path){
+		Bundle args=new Bundle();
+		args.putString(MediaScannerService.EXTRA_FILE_PATH,path);
+		context.startService(new Intent(context,MediaScannerService.class).putExtras(args));
+	}
+	/*private static boolean isScanning = false;
 	//	private boolean isScanningStarted = false;
 	private IReceiverNotify mNotify;
 
@@ -53,7 +91,7 @@
 		}
 	}
 
-	/** 服务是否正在运行 */
+	*//** 服务是否正在运行 *//*
 	public static boolean isServiceRunning(Context ctx, String name) {
 		ActivityManager manager = (ActivityManager) ctx.getSystemService(Context.ACTIVITY_SERVICE);
 		for (RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {
@@ -61,5 +99,5 @@
 				return true;
 		}
 		return false;
-	}
+	}*/
 }
Index: app/src/main/java/com/nmbb/oplayer/service/MediaScannerService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>GBK
===================================================================
--- app/src/main/java/com/nmbb/oplayer/service/MediaScannerService.java	(date 1453798017000)
+++ app/src/main/java/com/nmbb/oplayer/service/MediaScannerService.java	(date 1453882873000)
@@ -250,7 +250,7 @@
             bitmap = ThumbnailUtils.extractThumbnail(bitmap, ConvertUtils.dipToPX(ctx, ThumbnailUtils.TARGET_SIZE_MICRO_THUMBNAIL_WIDTH), ConvertUtils.dipToPX(ctx, ThumbnailUtils.TARGET_SIZE_MICRO_THUMBNAIL_HEIGHT), ThumbnailUtils.OPTIONS_RECYCLE_INPUT);
             if (bitmap != null) {
                 //将缩略图存到视频当前路径
-                File thum = new File(OPlayerApplication.OPLAYER_VIDEO_THUMB, UUID.randomUUID().toString());
+                File thum = new File(OPlayerApplication.OPLAYER_VIDEO_THUME, UUID.randomUUID().toString());
                 media.thumb_path = thum.getAbsolutePath();
                 //thum.createNewFile();
                 FileOutputStream iStream = new FileOutputStream(thum);
